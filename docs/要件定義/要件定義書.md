# 要件定義書

履歴情報を返却するマイクロサービス（履歴取得マイクロサービス）を新規作成する。

履歴情報を返却するマイクロサービスは以下のAPIを提供する
- 認証履歴返却API
- アカウントロック履歴返却API

## 技術仕様
- 言語：TypeScript
- フレームワーク：Next.js
- データベース：Oracle
- 主要ライブラリ：
  - oralcedb：Oracle接続
  - pino：ログ出力
 
## セキュリティ要件
ローカルネットワークからの利用のため、考慮不要

## API詳細
### 認証履歴返却API

#### 処理フロー
1. クエリ文字列でログインIDを受け取る
2. ログインIDをキーにIDリポジトリから外部IDを取得
3. 外部IDをキーにDBから認証履歴を取得
4. 認証履歴をJSON形式でレスポンス

#### 履歴として返却する項目
- 認証履歴
- IPアドレス
- 認証元サービス名

#### その他機能
- 返却する件数は最大100件
- 最新のものが一番上で返却する
- レスポンスで総件数も返却する

#### 非機能要件
- IDリポジトリから複数のユーザ情報が返却された場合はエラー（500）

#### DB
データベースは既存で存在するもの（Oracle）を使用する
DDLは[ddl](./データベース.ddl)を参照

#### IDリポジトリ
IDリポジトリのAPI定義は[API定義書](./API定義書.md)を参照

---
### アカウントロック履歴返却API

#### 処理フロー
1. クエリ文字列でログインIDを受け取る
2. ログインIDをキーにDBからアカウントロック情報を取得
3. アカウントロックの履歴をJSON形式でレスポンス

#### 履歴として返却する項目
- アカウントロック日
- IPアドレス

#### その他機能
- 返却する件数は最大100件
- 最新のものが一番上で返却する
- レスポンスで総件数も返却する

#### DB
データベースは既存で存在するもの（Oracle）を使用する
DDLは[ddl](./データベース.ddl)を参照



